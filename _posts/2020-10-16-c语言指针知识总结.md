---
layout:     post
title:     c语言指针总结

date:       2020-08-30
author:     肥仔
catalog: true
tags:
    - 嵌入式c
--- 
# c语言指针总结
## 基本知识点
基本知识点目录，如下：

<img src ="https://daniao2017.github.io/img/in_post/asserts//善于利用指针.png">


## 认识指针
下面是一个寻找比较两个数大小的小例子，可以仔细分析一下。
```
#include<stdio.h>
void swap(int *p1,int *p2);
int main(){
    int a,b;
    int *point_1,*point_2;
    printf("please enter a and b:");
    scanf("%d,%d",&a,&b);
    point_1 = &a;
    point_2 =&b;
    if(a<b) swap(point_1,point_2);
    printf("max=%d,min=%d",a,b);
    return 0;
}

void swap(int *p1,int *p2){
    int temp;
    temp = *p1;
    *p1 = *p2;
    *p2 = temp;
}
```
### 怎样定义指针变量
顾名思义，存放`指针`地址的变量就是`指针变量`。
定义如下：
**类型名** * **指针变量**
左侧的类型名，表示储存单元的长度以及数据的存储形式。和计算机要开辟的内存大小有关，指针变量则是，储存单元的地址。
如:
`int *p`,`char *b`,`float *c`等类型。

### 怎样引用指针变量
- 定义指针变量
  int * p
- 给指针赋值
p = & a
- 引用指针变量(输出是的是`地址`)
printf("%s",p)
- 输出指针的的对象值
printf("%s",*p), * 是指针运算符(或称`间接访问`运算符)。

*p代表指针变量P指向的对象

## 通过指针引用数组

下面是一个用指针指向数组，并求总平均数与第n个同学的例子。可以仔细分析一下。

````
#include<stdio.h>
void average(float *p,int n);
void search(float (*p)[4],int n);
/*-------------主函数--------------------*/
int main(){
    float score[3][4] ={{65,67,70,60},{80,87,90,81},{90,99,100,98}};
    average(*score,12);
    search(score,2);
    return 0;
}
/*--------------求平均数-----------------------------*/
void average(float *p,int n){
    float *p_end;
    float sum=0,aver;
    //n的值为12时，p_end的值是p+11，指向最后一个元素
    p_end = p+n-1;
    for(;p<=p_end;p++){
        sum = sum +(*p);
    }
    aver = sum/n;
    printf("average=%5.2f\n",aver);
    
}
/*------------------查找某一同学成绩------------------*/
void search(float (*p)[4],int n){
    int i;
    printf("The score fo No.%d\n",n);
    for(i=0;i<4;i++){
        printf("%5.2f\n",*(*(p+n)+i));
    }
    printf("\n");
}

````

### 程序分析

- 函数`average`
在函数`average`中形参p被声明成float* 类型(指向float型变量)的指针变量。他的基类型为`float`型，实参用`* score`,即`score[0]`,也就是`&score[0][0]`,即`score[0][0]`的地址。

- 函数`search`
函数`search`的形参p的类型是`float(*)[int]`,他不是指向整形变量的指针变量，而是指向包含4个元素的一维数组的指针变量。函数开始调用时，将实参score的值(代表该数组0行起始地址)传给p，使p也指向score[0]。p+n是score[n]的起始地址，`*(p+n)+i`是score[n][i]的地址，`*(*(p+n)+i)`是score[n][i]的值。现在实参传给形参n的值是2，即想找序号2的学生成绩

调用search函数时，实参是score(二维数组名，代表该数组0行起始地地址)传给p，使p也指向score[0],p+n是score[n]的起始地址，`*(p+n)+i`是score[n][i]的地址，*(*(p+n)+i)是score[n][i]的值。

## 通过指针引用字符串
下面是字符串复制的例子，可以仔细分析该代码
```
#include<stdio.h>
void copy_string(char *from,char *to);
int main(){
    char * a ="I am a teacher";
    char b[]="You are a student";
    //使指针变量p指向b数组首元素
    char *p =b;
    printf("string a =%s\nstring b=%s\n",a,b);
    printf("\ncopy string a to string b:\n");
    copy_string(a,p);
    printf("string a =%s\nstring b=%s\n",a,b);
    return 0;
        
}
/*---------------复制字符串-----------------*/
void copy_string(char *from,char *to){
    for(;*from!='\0';from++,to++){
        *to= *from;
        }
    *to = '\0';
}
```
## 指向函数的指针(重点)
```
#include<stdio.h>
/*
输入数字，有不同的结果
*/
int fun(int x,int y,int(*p)(int,int));
int max(int,int);
int min(int,int);
int add(int,int);

int main(){
    int a=88,b=66,n;
    printf("please choose 1,2 or 3:");
    scanf("%d",&n);
    if(n==1) fun(a,b,max);
    else if (n==2) fun(a,b,min);
    else if(n==3) fun(a,b,add);
    else 
        printf("输入格式有误");
    return 0;
}

int fun(int x,int y,int(*p)(int,int)){
    int result;
    result =(*p)(x,y);
    printf("%d\n",result);
}

int max(int x,int y){
    int z;
    if(x>y) z=x;
    else z=y;
    printf("max=");
    return(z);   
}
int min(int x,int y){
    int z;
    if(x<y) z=x;
    else z=y;
    printf("min=");
    return(z) ;
}

int add(int x,int y){
    int z;
    z = x+y;
    printf("sum=");
    return(z);
}
```
## 返回指针值的函数(重点)

 找出其中含有不合格课程的学生，及其学生号
```
#include<stdio.h>
/*
 * 找出其中含有不合格课程的学生，及其学生号
 */
float * search(float (*point)[4]);
int main(){    
    float score[3][4]={{60,70,80,90},{56,89,67,88},{34,75,90,66}};
    float *p;
    int i,j;
    for(i=0;i<3;i++){
        p = search(score+i);
        //调用search函数，如有不及格返回score[i][0]的地址
        //否则返回Null
        if(p==*(score+i)) //返回score[i][0]的值
        {
            printf("No.%d score:",i);
            for(j=0;j<4;j++) 
                printf("%5.2f ",*(p+j));
            printf("\n");
        }
    }
    return 0;
}
float * search(float (*pointer)[4]){
    int i=0;
    float * pt;
    pt = NULL;
    for ( ; i < 4; i++)
    {
        if(*(*pointer +i)<60){
            pt = *pointer;
        }
    }
    return pt;
    
}
```
## 有关指针的小结

- 要准确地弄清指针的含义。指针就是地址
- 什么叫`指向`
- 要深入掌握在数组的操作中正确的使用指针
- 有关指针变量的归纳比较
- 指针运算
- 指针变量可以有空值

更多小结应该联系实际代码进行分析总结，本篇小结是再次看某本书走了一遍流程。
